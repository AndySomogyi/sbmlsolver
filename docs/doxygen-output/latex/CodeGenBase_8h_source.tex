\hypertarget{CodeGenBase_8h_source}{}\doxysection{Code\+Gen\+Base.\+h}
\label{CodeGenBase_8h_source}\index{llvm/CodeGenBase.h@{llvm/CodeGenBase.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * CodeGenBase.h}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Created on: Jul 4, 2013}}
\DoxyCodeLine{5 \textcolor{comment}{ *      Author: andy}}
\DoxyCodeLine{6 \textcolor{comment}{ */}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#ifndef LLVMCodeGenBaseH}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#define LLVMCodeGenBaseH}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}ModelGeneratorContext.h"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}CodeGen.h"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}LLVMException.h"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}rrLogger.h"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <Poco/Logger.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}llvm/IR/Mangler.h"{}}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{using} \mbox{\hyperlink{classrr_1_1Logger}{rr::Logger}};}
\DoxyCodeLine{19 \textcolor{keyword}{using} rr::getLogger;}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{namespace }rrllvm}
\DoxyCodeLine{22 \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{24     \textcolor{keyword}{class }Jit;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{typedef} std::vector<std::string> StringVector;}
\DoxyCodeLine{27 \textcolor{keyword}{typedef} std::pair<std::string, int> StringIntPair;}
\DoxyCodeLine{28 \textcolor{keyword}{typedef} std::vector<StringIntPair> StringIntVector;}
\DoxyCodeLine{29 }
\DoxyCodeLine{36 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FunctionPtrType>}
\DoxyCodeLine{37 \textcolor{keyword}{class }\mbox{\hyperlink{classrrllvm_1_1CodeGenBase}{CodeGenBase}}}
\DoxyCodeLine{38 \{}
\DoxyCodeLine{39 \textcolor{keyword}{public}:}
\DoxyCodeLine{40     llvm::Function* createFunction()}
\DoxyCodeLine{41     \{}
\DoxyCodeLine{42         llvm::Function *func = (llvm::Function*)codeGen();}
\DoxyCodeLine{43 }
\DoxyCodeLine{44         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classrrllvm_1_1CodeGenBase_addedde72248fde005bff3060843de531}{functionPassManager}})}
\DoxyCodeLine{45         \{}
\DoxyCodeLine{46             \textcolor{comment}{//functionPassManager-\/>run(*func);}}
\DoxyCodeLine{47         \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49         \textcolor{keywordflow}{return} func;}
\DoxyCodeLine{50     \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \textcolor{keyword}{typedef} FunctionPtrType FunctionPtr;}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{keyword}{protected}:}
\DoxyCodeLine{55     \mbox{\hyperlink{classrrllvm_1_1CodeGenBase}{CodeGenBase}}(\textcolor{keyword}{const} \mbox{\hyperlink{classrrllvm_1_1ModelGeneratorContext}{ModelGeneratorContext}} \&mgc) :}
\DoxyCodeLine{56             modelGenContext(mgc),}
\DoxyCodeLine{57             \mbox{\hyperlink{classrrllvm_1_1CodeGenBase_afb6ef03ee896534cde79895141a8a666}{model}}(mgc.getModel()),}
\DoxyCodeLine{58             dataSymbols(mgc.getModelDataSymbols()),}
\DoxyCodeLine{59             modelSymbols(mgc.getModelSymbols()),}
\DoxyCodeLine{60             context(mgc.getJitNonOwning()-\/>\mbox{\hyperlink{classrrllvm_1_1Jit_a92e5c8af5539c0e790328d66ed325d26}{getModuleNonOwning}}()-\/>getContext()),}
\DoxyCodeLine{61             module(mgc.getJitNonOwning()-\/>\mbox{\hyperlink{classrrllvm_1_1Jit_a92e5c8af5539c0e790328d66ed325d26}{getModuleNonOwning}}()),}
\DoxyCodeLine{62             builder(*mgc.getJitNonOwning()-\/>\mbox{\hyperlink{classrrllvm_1_1Jit_afb8cf53b3bde8eaa539b14cc685cb200}{getBuilderNonOwning}}()),}
\DoxyCodeLine{63             \mbox{\hyperlink{classrrllvm_1_1CodeGenBase_a747be8f3c35284547ad6f31b36736471}{options}}(mgc.getOptions()),}
\DoxyCodeLine{64             function(0)}
\DoxyCodeLine{65 \textcolor{comment}{//            functionPassManager(mgc.getJitNonOwning().getFunctionPassManager())}}
\DoxyCodeLine{66     \{}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \};}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{keyword}{const} \mbox{\hyperlink{classrrllvm_1_1ModelGeneratorContext}{ModelGeneratorContext}} \&modelGenContext;}
\DoxyCodeLine{71 }
\DoxyCodeLine{75     \textcolor{keyword}{const} libsbml::Model *\mbox{\hyperlink{classrrllvm_1_1CodeGenBase_afb6ef03ee896534cde79895141a8a666}{model}};}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \textcolor{keyword}{const} \mbox{\hyperlink{classrrllvm_1_1LLVMModelDataSymbols}{LLVMModelDataSymbols}} \&dataSymbols;}
\DoxyCodeLine{78     \textcolor{keyword}{const} \mbox{\hyperlink{classrrllvm_1_1LLVMModelSymbols}{LLVMModelSymbols}} \&modelSymbols;}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     llvm::LLVMContext \&context;}
\DoxyCodeLine{81     llvm::Module *module;}
\DoxyCodeLine{82     llvm::IRBuilder<> \&builder;}
\DoxyCodeLine{83     llvm::Function *function;}
\DoxyCodeLine{84 }
\DoxyCodeLine{88     llvm::legacy::FunctionPassManager* \mbox{\hyperlink{classrrllvm_1_1CodeGenBase_addedde72248fde005bff3060843de531}{functionPassManager}};}
\DoxyCodeLine{89 }
\DoxyCodeLine{93     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classrrllvm_1_1CodeGenBase_a747be8f3c35284547ad6f31b36736471}{options}};}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \textcolor{keyword}{virtual} llvm::Value *codeGen() = 0;}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} N>}
\DoxyCodeLine{98     llvm::BasicBlock *codeGenHeader(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* functionName,}
\DoxyCodeLine{99             llvm::Type *retType,}
\DoxyCodeLine{100             llvm::Type* (\&argTypes)[N],}
\DoxyCodeLine{101             \textcolor{keyword}{const} \textcolor{keywordtype}{char}* (\&argNames)[N],}
\DoxyCodeLine{102             llvm::Value* (\&args)[N])}
\DoxyCodeLine{103     \{}
\DoxyCodeLine{104         \textcolor{comment}{// make the set init value function}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106         llvm::FunctionType *funcType = llvm::FunctionType::get(retType, argTypes, \textcolor{keyword}{false});}
\DoxyCodeLine{107         function = llvm::Function::Create(funcType,}
\DoxyCodeLine{108                 llvm::Function::ExternalLinkage,}
\DoxyCodeLine{109                 functionName, module);}
\DoxyCodeLine{110 }
\DoxyCodeLine{111         \textcolor{comment}{// Create a new basic block to start insertion into.}}
\DoxyCodeLine{112         llvm::BasicBlock *basicBlock = llvm::BasicBlock::Create(context,\textcolor{stringliteral}{"{}entry"{}}, function);}
\DoxyCodeLine{113         builder.SetInsertPoint(basicBlock);}
\DoxyCodeLine{114 }
\DoxyCodeLine{115         assert(function-\/>arg\_size() == N);}
\DoxyCodeLine{116 }
\DoxyCodeLine{117         \textcolor{keywordtype}{int} i = 0;}
\DoxyCodeLine{118         \textcolor{keywordflow}{for} (llvm::Function::arg\_iterator ai = function-\/>arg\_begin();}
\DoxyCodeLine{119                 ai != function-\/>arg\_end(); ++ai, ++i)}
\DoxyCodeLine{120         \{}
\DoxyCodeLine{121             llvm::Value *arg = ai;}
\DoxyCodeLine{122             arg-\/>setName(argNames[i]);}
\DoxyCodeLine{123             args[i] = arg;}
\DoxyCodeLine{124         \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126         \textcolor{keywordflow}{return} basicBlock;}
\DoxyCodeLine{127     \}}
\DoxyCodeLine{128 }
\DoxyCodeLine{133     llvm::BasicBlock *\mbox{\hyperlink{classrrllvm_1_1CodeGenBase_aad34a1df81ff99ee0c20e7de8cba89f2}{codeGenVoidModelDataHeader}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* functionName,llvm::Value* \&modelData)}
\DoxyCodeLine{134     \{}
\DoxyCodeLine{135         llvm::Type *argTypes[] = \{}
\DoxyCodeLine{136             llvm::PointerType::get(}
\DoxyCodeLine{137                 \mbox{\hyperlink{classrrllvm_1_1ModelDataIRBuilder_a0ef021e16b99691a0cde663060898c4c}{ModelDataIRBuilder::getStructType}}(module), 0)}
\DoxyCodeLine{138         \};}
\DoxyCodeLine{139 }
\DoxyCodeLine{140         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *argNames[] = \{ \textcolor{stringliteral}{"{}modelData"{}} \};}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         llvm::Value *args[] = \{ 0 \};}
\DoxyCodeLine{143 }
\DoxyCodeLine{144         llvm::BasicBlock *basicBlock = codeGenHeader(functionName,}
\DoxyCodeLine{145                 llvm::Type::getVoidTy(context),}
\DoxyCodeLine{146                     argTypes, argNames, args);}
\DoxyCodeLine{147 }
\DoxyCodeLine{148         modelData = args[0];}
\DoxyCodeLine{149         \textcolor{keywordflow}{return} basicBlock;}
\DoxyCodeLine{150     \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152     llvm::Function *\mbox{\hyperlink{classrrllvm_1_1CodeGenBase_a85538605d4b0d3dc1f6e1a69afe6eb8e}{verifyFunction}}()}
\DoxyCodeLine{153     \{}
\DoxyCodeLine{154         rrLogInfo << std::string(\textcolor{stringliteral}{"{}function: "{}}) + to\_string(function);}
\DoxyCodeLine{155 }
\DoxyCodeLine{158         \textcolor{keywordflow}{if} (llvm::verifyFunction(*function))}
\DoxyCodeLine{159         \{}
\DoxyCodeLine{160             std::string err = \textcolor{stringliteral}{"{}Corrupt Generated Function, "{}}  + to\_string(function);}
\DoxyCodeLine{161             rrLogErr << err;}
\DoxyCodeLine{162 }
\DoxyCodeLine{163             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classrrllvm_1_1LLVMException}{LLVMException}}(err);}
\DoxyCodeLine{164         \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{166         \textcolor{keywordflow}{return} function;}
\DoxyCodeLine{167     \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 }
\DoxyCodeLine{170     \textcolor{keyword}{virtual} \mbox{\hyperlink{classrrllvm_1_1CodeGenBase}{\string~CodeGenBase}}() \{\};}
\DoxyCodeLine{171 }
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \};}
\DoxyCodeLine{174 }
\DoxyCodeLine{175 \} \textcolor{comment}{/* namespace rr */}}
\DoxyCodeLine{176 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* LLVMCodeGenBaseH */}\textcolor{preprocessor}{}}

\end{DoxyCode}
